# üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ Edge Function: –î–∞–Ω–Ω—ã–µ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è

## ‚úÖ –ö–ª—é—á–∏ —Å–æ–≤–ø–∞–¥–∞—é—Ç ‚Äî —Ö–æ—Ä–æ—à–æ!

–¢–µ–ø–µ—Ä—å –ø—Ä–æ–≤–µ—Ä–∏–º Edge Function –∏ —Å–µ–∫—Ä–µ—Ç—ã.

---

## üìã –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Edge Function

### 1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Edge Functions

1. –í –ª–µ–≤–æ–º –º–µ–Ω—é Supabase –Ω–∞–∂–º–∏—Ç–µ **"Edge Functions"** (–∏–∫–æ–Ω–∫–∞ —Å –º–æ–ª–Ω–∏–µ–π ‚ö°)
2. –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ñ—É–Ω–∫—Ü–∏—è **`sync`**
3. –°—Ç–∞—Ç—É—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å **"Active"** (–∑–µ–ª–µ–Ω—ã–π)

**–ï—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–µ—Ç:**
- –°–æ–∑–¥–∞–π—Ç–µ –µ—ë (—Å–º. –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –≤—ã—à–µ)

**–ï—Å–ª–∏ —Å—Ç–∞—Ç—É—Å –Ω–µ "Active":**
- –ù–∞–∂–º–∏—Ç–µ "Deploy" –∏–ª–∏ "Redeploy"

---

## üìã –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ Edge Function

### 1. –û—Ç–∫—Ä–æ–π—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ–∫—Ä–µ—Ç–æ–≤

1. Settings ‚Üí **Edge Functions** ‚Üí **Secrets**
2. –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –¥–≤–∞ —Å–µ–∫—Ä–µ—Ç–∞:

**–°–µ–∫—Ä–µ—Ç 1:**
- **Name**: `BOT_TOKEN`
- **Value**: `7568002456:AAFpZOYNjGXbYxaeZ-fdQwliyCApbpZ7B3A`

**–°–µ–∫—Ä–µ—Ç 2:**
- **Name**: `TELEGRAM_CHANNEL_ID`
- **Value**: `-1001781839176`

**–ï—Å–ª–∏ —Å–µ–∫—Ä–µ—Ç–æ–≤ –Ω–µ—Ç:**
- –î–æ–±–∞–≤—å—Ç–µ –∏—Ö (—Å–º. –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –≤—ã—à–µ)

**–ï—Å–ª–∏ —Å–µ–∫—Ä–µ—Ç—ã –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç:**
- –û–±–Ω–æ–≤–∏—Ç–µ –∏—Ö

---

## üìã –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Edge Function

### 1. –û—Ç–∫—Ä–æ–π—Ç–µ –ª–æ–≥–∏

1. Edge Functions ‚Üí **`sync`** ‚Üí **Logs**
2. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Telegram
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ (—Å—á–µ—Ç –∏–ª–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é)
4. –í–µ—Ä–Ω–∏—Ç–µ—Å—å –≤ –ª–æ–≥–∏ ‚Äî –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –Ω–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏

**–ß—Ç–æ –∏—Å–∫–∞—Ç—å –≤ –ª–æ–≥–∞—Ö:**

**A. –ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ –æ—à–∏–±–∫–∏:**
- –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–µ–∫—Ä–µ—Ç—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ

**B. –ï—Å–ª–∏ –ª–æ–≥–æ–≤ –Ω–µ—Ç –≤–æ–æ–±—â–µ:**
- Edge Function –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL –≤ –∫–æ–¥–µ

**C. –ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ —É—Å–ø–µ—à–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã:**
- Edge Function —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∞–±–ª–∏—Ü—ã –≤ Supabase

---

## üìã –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∞–±–ª–∏—Ü—ã –≤ Supabase

### 1. –û—Ç–∫—Ä–æ–π—Ç–µ Table Editor

1. –í –ª–µ–≤–æ–º –º–µ–Ω—é Supabase –Ω–∞–∂–º–∏—Ç–µ **"Table Editor"**
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∞–±–ª–∏—Ü—É **`users`**:
   - –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∑–∞–ø–∏—Å—å —Å –≤–∞—à–∏–º `telegram_user_id`
   - `is_subscriber` –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å `true`

3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∞–±–ª–∏—Ü—É **`user_data`**:
   - –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–ø–∏—Å–∏ —Å –≤–∞—à–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏
   - `key` –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å: `accounts`, `transactions`, –∏ —Ç.–¥.

**–ï—Å–ª–∏ —Ç–∞–±–ª–∏—Ü—ã –ø—É—Å—Ç—ã–µ:**
- –î–∞–Ω–Ω—ã–µ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Edge Function
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞

---

## üìã –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞

### 1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Telegram

1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. –ù–∞–∂–º–∏—Ç–µ F12 (–≤ –≤–µ–±-–≤–µ—Ä—Å–∏–∏) –∏–ª–∏ –æ—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É **"Console"**
4. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—à–∏–±–∫–∏

**–ß—Ç–æ –∏—Å–∫–∞—Ç—å:**

**A. "API not configured"**
- GitHub Secrets –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã
- –†–µ—à–µ–Ω–∏–µ: –¥–æ–±–∞–≤—å—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ GitHub

**B. "Failed to load from server"**
- Edge Function –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –†–µ—à–µ–Ω–∏–µ: –ø—Ä–æ–≤–µ—Ä—å—Ç–µ Edge Function –∏ –ª–æ–≥–∏

**C. "NOT_SUBSCRIBED"**
- –ù–µ –ø–æ–¥–ø–∏—Å–∞–Ω—ã –Ω–∞ –∫–∞–Ω–∞–ª
- –†–µ—à–µ–Ω–∏–µ: –ø–æ–¥–ø–∏—à–∏—Ç–µ—Å—å –Ω–∞ `@mansurmlrd`

**D. CORS –æ—à–∏–±–∫–∏**
- –ü—Ä–æ–±–ª–µ–º–∞ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ Edge Function
- –†–µ—à–µ–Ω–∏–µ: –ø—Ä–æ–≤–µ—Ä—å—Ç–µ CORS headers

**E. –ù–µ—Ç –æ—à–∏–±–æ–∫, –Ω–æ –¥–∞–Ω–Ω—ã–µ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `saveToServer` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Edge Function

---

## üìã –®–∞–≥ 6: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ –∫–∞–Ω–∞–ª

### 1. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–∞–Ω–∞–ª

1. –û—Ç–∫—Ä–æ–π—Ç–µ: https://t.me/mansurmlrd
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã **–ø–æ–¥–ø–∏—Å–∞–Ω—ã**
3. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Telegram
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å (F12) ‚Äî –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—à–∏–±–∫–∏ "NOT_SUBSCRIBED"

**–ï—Å–ª–∏ –æ—à–∏–±–∫–∞ "NOT_SUBSCRIBED":**
- –ü–æ–¥–ø–∏—à–∏—Ç–µ—Å—å –Ω–∞ –∫–∞–Ω–∞–ª
- –û–±–Ω–æ–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

---

## üß™ –¢–µ—Å—Ç –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞

–û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Telegram, –Ω–∞–∂–º–∏—Ç–µ F12 ‚Üí Console –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```javascript
// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ API –Ω–∞—Å—Ç—Ä–æ–µ–Ω
console.log('Supabase URL:', import.meta.env.VITE_SUPABASE_URL);
console.log('Supabase Key:', import.meta.env.VITE_SUPABASE_ANON_KEY?.substring(0, 20) + '...');

// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å initData
const initData = window.Telegram?.WebApp?.initData;
console.log('InitData:', initData ? '–ï—Å—Ç—å' : '–ù–µ—Ç');

// –¢–µ—Å—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
const testData = {
  accounts: [{ id: 1, name: '–¢–µ—Å—Ç', currency: 'RUB', balance: 100, color: '#2481cc' }]
};

fetch('https://zhchkxukgltknfbropqu.supabase.co/functions/v1/sync', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Authorization': 'Bearer sb_publishable_m96BQEXNJw5_L_CI0kQkUg_0vdPodFS',
    'x-telegram-init-data': initData
  },
  body: JSON.stringify(testData)
})
.then(r => r.json())
.then(data => {
  console.log('–†–µ–∑—É–ª—å—Ç–∞—Ç:', data);
  if (data.success) {
    console.log('‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
  } else {
    console.log('‚ùå –û—à–∏–±–∫–∞:', data.error);
  }
})
.catch(err => console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞:', err));
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å—Å—è `{ success: true }`
- –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ ‚Äî –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏

---

## ‚ùì –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞ 1: Edge Function –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω–∞:** URL –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∏–ª–∏ GitHub Secrets –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ GitHub Secrets
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL –≤ –∫–æ–¥–µ
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –¥–µ–ø–ª–æ–π

### –ü—Ä–æ–±–ª–µ–º–∞ 2: "NOT_SUBSCRIBED"

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ –ø–æ–¥–ø–∏—Å–∞–Ω—ã –Ω–∞ –∫–∞–Ω–∞–ª

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü–æ–¥–ø–∏—à–∏—Ç–µ—Å—å –Ω–∞ `@mansurmlrd`
2. –û–±–Ω–æ–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –î–∞–Ω–Ω—ã–µ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è, –Ω–æ –æ—à–∏–±–æ–∫ –Ω–µ—Ç

**–ü—Ä–∏—á–∏–Ω–∞:** –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ —Ñ–æ–Ω–µ, –Ω–æ –Ω–µ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Edge Function
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–µ–∫—Ä–µ—Ç—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∞–±–ª–∏—Ü—ã –≤ Supabase

---

## üÜò –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å:

1. ‚úÖ Edge Function `sync` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –∞–∫—Ç–∏–≤–Ω–∞?
2. ‚úÖ –°–µ–∫—Ä–µ—Ç—ã `BOT_TOKEN` –∏ `TELEGRAM_CHANNEL_ID` –¥–æ–±–∞–≤–ª–µ–Ω—ã?
3. ‚úÖ –ï—Å—Ç—å –ª–∏ –ª–æ–≥–∏ –≤ Edge Function –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö?
4. ‚úÖ –ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12)?
5. ‚úÖ –ü–æ–¥–ø–∏—Å–∞–Ω—ã –ª–∏ –≤—ã –Ω–∞ –∫–∞–Ω–∞–ª `@mansurmlrd`?

---

## üìù –û—Ç—á–µ—Ç –æ –ø—Ä–æ–≤–µ—Ä–∫–µ

–ü–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–æ–±—â–∏—Ç–µ:

1. **Edge Function:**
   - –°—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —Ñ—É–Ω–∫—Ü–∏—è `sync`?
   - –°—Ç–∞—Ç—É—Å "Active"?

2. **–°–µ–∫—Ä–µ—Ç—ã:**
   - –î–æ–±–∞–≤–ª–µ–Ω—ã –ª–∏ `BOT_TOKEN` –∏ `TELEGRAM_CHANNEL_ID`?

3. **–õ–æ–≥–∏:**
   - –ü–æ—è–≤–ª—è—é—Ç—Å—è –ª–∏ –ª–æ–≥–∏ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö?
   - –ö–∞–∫–∏–µ –æ—à–∏–±–∫–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)?

4. **–ö–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞:**
   - –ö–∞–∫–∏–µ –æ—à–∏–±–∫–∏ –≤–∏–¥–Ω—ã (F12)?

5. **–¢–∞–±–ª–∏—Ü—ã:**
   - –ï—Å—Ç—å –ª–∏ –¥–∞–Ω–Ω—ã–µ –≤ `users` –∏ `user_data`?
