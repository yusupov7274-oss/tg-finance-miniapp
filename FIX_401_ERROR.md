# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 401 Unauthorized –æ—à–∏–±–æ–∫

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞!

**401 Unauthorized** –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –∑–∞–ø—Ä–æ—Å—ã –Ω–µ –ø—Ä–æ—Ö–æ–¥—è—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –Ω–∞ —É—Ä–æ–≤–Ω–µ Supabase.

**–ü—Ä–∏—á–∏–Ω—ã:**
1. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π Authorization header
2. –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π `x-telegram-init-data`
3. –ü—Ä–æ–±–ª–µ–º–∞ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –≤ Edge Function

**–í–∞–∂–Ω–æ:** `execution id: null` –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è –¥–∞–∂–µ –Ω–µ –≤—ã–ø–æ–ª–Ω–∏–ª–∞—Å—å ‚Äî –∑–∞–ø—Ä–æ—Å –±—ã–ª –æ—Ç–∫–ª–æ–Ω–µ–Ω –¥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ 1: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Authorization header

### –ü—Ä–æ–±–ª–µ–º–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ —Ç–æ–º, —á—Ç–æ Edge Function —Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é Supabase

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–¥ Edge Function ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ, –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–æ–π —Å–ø–æ—Å–æ–± –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ 2: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–¥–∞—á—É initData

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ initData –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è

–û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Telegram, F12 ‚Üí Console –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```javascript
// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å initData
const initData = window.Telegram?.WebApp?.initData;
console.log('InitData:', initData ? '–ï—Å—Ç—å ‚úÖ' : '–ù–µ—Ç ‚ùå');
console.log('InitData length:', initData?.length || 0);
```

**–ï—Å–ª–∏ initData –Ω–µ—Ç:**
- –ü—Ä–æ–±–ª–µ–º–∞ –≤ Telegram WebApp
- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ 3: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Edge Function

–ü—Ä–æ–±–ª–µ–º–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ —Ç–æ–º, —á—Ç–æ Edge Function –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é Supabase, –∫–æ—Ç–æ—Ä–∞—è —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π JWT —Ç–æ–∫–µ–Ω.

–ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥ Edge Function –∏ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –æ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –±–µ–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ Supabase.

---

## üß™ –¢–µ—Å—Ç –∑–∞–ø—Ä–æ—Å–∞

–û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Telegram, F12 ‚Üí Console –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```javascript
const initData = window.Telegram?.WebApp?.initData;

if (!initData) {
  console.error('‚ùå InitData –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω!');
} else {
  console.log('‚úÖ InitData –µ—Å—Ç—å, –¥–ª–∏–Ω–∞:', initData.length);
  
  // –¢–µ—Å—Ç –∑–∞–ø—Ä–æ—Å–∞
  fetch('https://zhchkxukgltknfbropqu.supabase.co/functions/v1/sync', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': 'Bearer sb_publishable_m96BQEXNJw5_L_CI0kQkUg_0vdPodFS',
      'x-telegram-init-data': initData
    },
    body: JSON.stringify({
      accounts: [{ id: 1, name: '–¢–µ—Å—Ç', currency: 'RUB', balance: 100, color: '#2481cc' }]
    })
  })
  .then(r => {
    console.log('Status:', r.status);
    console.log('Headers:', [...r.headers.entries()]);
    return r.text();
  })
  .then(text => {
    console.log('Response:', text);
    try {
      const data = JSON.parse(text);
      console.log('Parsed:', data);
    } catch(e) {
      console.log('Not JSON');
    }
  })
  .catch(err => console.error('‚ùå –û—à–∏–±–∫–∞:', err));
}
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ï—Å–ª–∏ 401 ‚Äî –ø—Ä–æ–±–ª–µ–º–∞ —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π
- –ï—Å–ª–∏ 200 ‚Äî –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## üìù –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

1. ‚úÖ **InitData –¥–æ—Å—Ç—É–ø–µ–Ω?** (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª–∏)
2. ‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π Authorization header?** (Bearer token)
3. ‚úÖ **–ö–æ–¥ Edge Function** ‚Äî –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é?

---

## üîß –í–æ–∑–º–æ–∂–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

–ü—Ä–æ–±–ª–µ–º–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ —Ç–æ–º, —á—Ç–æ Edge Function —Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é Supabase, –Ω–æ –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–∞—Å—Ç–æ–º–Ω—É—é –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é —á–µ—Ä–µ–∑ initData.

–ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥ Edge Function –∏ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –æ–Ω –Ω–µ —Ç—Ä–µ–±—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é Supabase –¥–ª—è —ç—Ç–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.
