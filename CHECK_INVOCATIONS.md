# üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ Invocations: –î–µ—Ç–∞–ª–∏ –∑–∞–ø—Ä–æ—Å–æ–≤

## ‚úÖ –õ–æ–≥–∏ —á–∏—Å—Ç—ã–µ ‚Äî —Ö–æ—Ä–æ—à–æ!

–ù–æ –Ω–∞ Overview –≤–∏–¥–Ω–æ –º–Ω–æ–≥–æ 4xx –æ—à–∏–±–æ–∫. –ü—Ä–æ–≤–µ—Ä–∏–º –¥–µ—Ç–∞–ª–∏ –∑–∞–ø—Ä–æ—Å–æ–≤.

---

## üìã –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∫–ª–∞–¥–∫—É "Invocations"

### 1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É "Invocations"

1. –í Edge Function `sync` –ø–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É **"Invocations"** (—Ä—è–¥–æ–º —Å "Logs")
2. –¢–∞–º –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –¥–µ—Ç–∞–ª–∏ –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
3. –ù–∞–π–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å—ã —Å **4xx —Å—Ç–∞—Ç—É—Å–æ–º** (–∂–µ–ª—Ç—ã–µ/–∫—Ä–∞—Å–Ω—ã–µ)

**–ß—Ç–æ –∏—Å–∫–∞—Ç—å:**

**A. –ó–∞–ø—Ä–æ—Å—ã —Å 4xx —Å—Ç–∞—Ç—É—Å–æ–º:**
- –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∑–∞–ø—Ä–æ—Å, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –¥–µ—Ç–∞–ª–∏
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
  - **Request headers** ‚Äî –µ—Å—Ç—å –ª–∏ `x-telegram-init-data`?
  - **Response body** ‚Äî –∫–∞–∫–∞—è –æ—à–∏–±–∫–∞?
  - **Status code** ‚Äî –∫–∞–∫–æ–π –∏–º–µ–Ω–Ω–æ –∫–æ–¥ (401, 403, 404)?

**B. –ó–∞–ø—Ä–æ—Å—ã —Å 2xx —Å—Ç–∞—Ç—É—Å–æ–º:**
- –≠—Ç–æ —É—Å–ø–µ—à–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –µ—Å—Ç—å –ª–∏ –æ–Ω–∏ –≤–æ–æ–±—â–µ

---

## üìã –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ª–∏ Edge Function

### 1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Telegram

1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. F12 ‚Üí Console
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ (—Å—á–µ—Ç –∏–ª–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é)
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –µ—Å—Ç—å –ª–∏ –∑–∞–ø—Ä–æ—Å—ã –∫ Supabase

**–ß—Ç–æ –∏—Å–∫–∞—Ç—å –≤ –∫–æ–Ω—Å–æ–ª–∏:**

**A. –ó–∞–ø—Ä–æ—Å—ã –∫ Supabase:**
```javascript
// –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∫:
https://zhchkxukgltknfbropqu.supabase.co/functions/v1/sync
```

**B. –û—à–∏–±–∫–∏:**
- "Failed to save to server"
- "NOT_SUBSCRIBED"
- "API not configured"

**C. –£—Å–ø–µ—à–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã:**
- –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –±–µ–∑ –æ—à–∏–±–æ–∫

---

## üìã –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Network tab

### 1. –û—Ç–∫—Ä–æ–π—Ç–µ Network tab

1. F12 ‚Üí Network
2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
3. –ù–∞–π–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å—ã –∫ `sync`
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
   - **Status** ‚Äî –∫–∞–∫–æ–π –∫–æ–¥ –æ—Ç–≤–µ—Ç–∞?
   - **Request Headers** ‚Äî –µ—Å—Ç—å –ª–∏ `x-telegram-init-data`?
   - **Response** ‚Äî —á—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–µ—Ä–≤–µ—Ä?

**–ß—Ç–æ –∏—Å–∫–∞—Ç—å:**

**A. –ó–∞–ø—Ä–æ—Å—ã —Å 4xx —Å—Ç–∞—Ç—É—Å–æ–º:**
- –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∑–∞–ø—Ä–æ—Å
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Response ‚Äî –∫–∞–∫–∞—è –æ—à–∏–±–∫–∞?

**B. –ó–∞–ø—Ä–æ—Å—ã —Å 2xx —Å—Ç–∞—Ç—É—Å–æ–º:**
- –≠—Ç–æ —É—Å–ø–µ—à–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Response ‚Äî –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `{ success: true }`

---

## üìã –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ª–∏ –¥–∞–Ω–Ω—ã–µ –ª–æ–∫–∞–ª—å–Ω–æ

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ localStorage

1. F12 ‚Üí Console
2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ:

```javascript
// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ localStorage
const keys = ['accounts', 'transactions', 'currencies', 'expense_plan'];
keys.forEach(key => {
  const value = localStorage.getItem('finance_' + key);
  console.log(key + ':', value ? '–ï—Å—Ç—å ‚úÖ' : '–ù–µ—Ç ‚ùå');
  if (value) {
    try {
      const parsed = JSON.parse(value);
      console.log('  –î–∞–Ω–Ω—ã–µ:', parsed);
    } catch(e) {
      console.log('  –ó–Ω–∞—á–µ–Ω–∏–µ:', value);
    }
  }
});
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –î–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ localStorage
- –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç ‚Äî –ø—Ä–æ–±–ª–µ–º–∞ –≤ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏

---

## üìã –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ª–∏ saveToServer

1. F12 ‚Üí Console
2. –î–æ–±–∞–≤—å—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –µ—Å—Ç—å –ª–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏:
   - "Background sync failed" ‚Äî —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
   - "Failed to save to server" ‚Äî –æ—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
   - –ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π ‚Äî —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–æ–∂–µ—Ç –Ω–µ –≤—ã–∑—ã–≤–∞—Ç—å—Å—è

---

## üß™ –¢–µ—Å—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Ä—É—á–Ω—É—é

–û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Telegram, F12 ‚Üí Console –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```javascript
// –ü–æ–ª—É—á–∏—Ç—å initData
const initData = window.Telegram?.WebApp?.initData;
console.log('InitData:', initData ? '–ï—Å—Ç—å ‚úÖ' : '–ù–µ—Ç ‚ùå');

if (!initData) {
  console.error('‚ùå InitData –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω!');
} else {
  // –¢–µ—Å—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
  const testData = {
    accounts: [{ id: 1, name: '–¢–µ—Å—Ç', currency: 'RUB', balance: 100, color: '#2481cc' }],
    transactions: []
  };

  console.log('–û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö...');
  
  fetch('https://zhchkxukgltknfbropqu.supabase.co/functions/v1/sync', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': 'Bearer sb_publishable_m96BQEXNJw5_L_CI0kQkUg_0vdPodFS',
      'x-telegram-init-data': initData
    },
    body: JSON.stringify(testData)
  })
  .then(r => {
    console.log('Status:', r.status);
    return r.json();
  })
  .then(data => {
    console.log('Response:', data);
    if (data.success) {
      console.log('‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
    } else if (data.error) {
      console.error('‚ùå –û—à–∏–±–∫–∞:', data.error);
      if (data.code === 'NOT_SUBSCRIBED') {
        console.error('‚ö†Ô∏è –ù–µ –ø–æ–¥–ø–∏—Å–∞–Ω—ã –Ω–∞ –∫–∞–Ω–∞–ª!');
      }
    }
  })
  .catch(err => console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞:', err));
}
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å—Å—è `{ success: true }`
- –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ ‚Äî –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏

---

## üìù –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

1. ‚úÖ **–í–∫–ª–∞–¥–∫–∞ "Invocations"** ‚Äî –¥–µ—Ç–∞–ª–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ —Å 4xx –æ—à–∏–±–∫–∞–º–∏
2. ‚úÖ **–ö–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞** (F12) ‚Äî –µ—Å—Ç—å –ª–∏ –∑–∞–ø—Ä–æ—Å—ã –∫ Supabase?
3. ‚úÖ **Network tab** (F12) ‚Äî –¥–µ—Ç–∞–ª–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤
4. ‚úÖ **localStorage** ‚Äî —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ª–∏ –¥–∞–Ω–Ω—ã–µ –ª–æ–∫–∞–ª—å–Ω–æ?
5. ‚úÖ **–¢–µ—Å—Ç –≤—Ä—É—á–Ω—É—é** ‚Äî —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ?

---

## üÜò –ü—Ä–∏—à–ª–∏—Ç–µ:

1. **–°–∫—Ä–∏–Ω—à–æ—Ç –≤–∫–ª–∞–¥–∫–∏ "Invocations"** ‚Äî –∫–∞–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã —Ç–∞–º –µ—Å—Ç—å?
2. **–ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞** (F12 ‚Üí Console) –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
3. **–†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∞ –≤—Ä—É—á–Ω—É—é** (–∫–æ–¥ –≤—ã—à–µ)

–≠—Ç–æ –ø–æ–º–æ–∂–µ—Ç —Ç–æ—á–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –≥–¥–µ –ø—Ä–æ–±–ª–µ–º–∞!
