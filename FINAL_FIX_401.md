# üîß –§–∏–Ω–∞–ª—å–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 401 –æ—à–∏–±–æ–∫

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: –í—Å–µ –µ—â–µ 401 –æ—à–∏–±–∫–∏

`execution id: null` –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –∑–∞–ø—Ä–æ—Å –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è –î–û –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏.

**–ü—Ä–∏—á–∏–Ω–∞:** Supabase Edge Functions —Ç—Ä–µ–±—É—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –¥–ª—è –≤—ã–∑–æ–≤–∞ —Ñ—É–Ω–∫—Ü–∏–∏.

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ: –î–æ–±–∞–≤–∏—Ç—å `apikey` header

–Ø –æ–±–Ω–æ–≤–∏–ª –∫–æ–¥ –≤ `web/src/lib/api.js` ‚Äî —Ç–µ–ø–µ—Ä—å –æ–Ω –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `apikey` header –≤–º–µ—Å—Ç–µ —Å `Authorization`.

### –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å:

1. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `apikey` header –≤ GET –∑–∞–ø—Ä–æ—Å—ã
2. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `apikey` header –≤ POST –∑–∞–ø—Ä–æ—Å—ã
3. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω Edge Function –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è service_role key

---

## üìã –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:

### 1. –î–æ–±–∞–≤—å—Ç–µ service_role key –∫–∞–∫ —Å–µ–∫—Ä–µ—Ç

1. Supabase ‚Üí Settings ‚Üí **Edge Functions** ‚Üí **Secrets**
2. –ù–∞–∂–º–∏—Ç–µ **"Add new secret"**
3. –î–æ–±–∞–≤—å—Ç–µ:
   - **Name**: `SUPABASE_SERVICE_ROLE_KEY`
   - **Value**: `sb_secret_gUvwicd0QLe6PI-R-5rtcQ_vsm58rLJ`
   - –ù–∞–∂–º–∏—Ç–µ **"Add secret"**

### 2. –û–±–Ω–æ–≤–∏—Ç–µ Edge Function

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `supabase_edge_function_sync_FULL.ts`
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤–µ—Å—å –∫–æ–¥
3. Supabase ‚Üí Edge Functions ‚Üí `sync` ‚Üí **Code**
4. –í—Å—Ç–∞–≤—å—Ç–µ –∫–æ–¥
5. –ù–∞–∂–º–∏—Ç–µ **"Deploy"**

### 3. –ó–∞–¥–µ–ø–ª–æ–π—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```bash
cd /Users/mansurusupov/tg-finance-miniapp
git add .
git commit -m "Fix: Add apikey header to Supabase requests"
git push
```

---

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:

1. –î–æ–∂–¥–∏—Ç–µ—Å—å –¥–µ–ø–ª–æ—è –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
2. –û–±–Ω–æ–≤–∏—Ç–µ Edge Function
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Invocations ‚Äî –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å 200 OK
4. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Telegram
5. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
6. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∞–±–ª–∏—Ü—ã ‚Äî –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –¥–∞–Ω–Ω—ã–µ

---

## ‚ùì –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –ª–∏ —Å–µ–∫—Ä–µ—Ç `SUPABASE_SERVICE_ROLE_KEY`?
2. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω –ª–∏ –∫–æ–¥ Edge Function?
3. ‚úÖ –ó–∞–¥–µ–ø–ª–æ–µ–Ω –ª–∏ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ?
4. ‚úÖ –ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12)?

---

## üìù –í–∞–∂–Ω–æ:

- `apikey` header —Ç—Ä–µ–±—É–µ—Ç—Å—è Supabase –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ Edge Functions
- `service_role` key –æ–±—Ö–æ–¥–∏—Ç RLS, –Ω–æ –º—ã –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–ø–∏—Å–∫—É –≤ –∫–æ–¥–µ
- –≠—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ, —Ç–∞–∫ –∫–∞–∫ –º—ã –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ –∫–∞–Ω–∞–ª
