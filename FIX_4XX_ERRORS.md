# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 4xx –æ—à–∏–±–æ–∫ –≤ Edge Function

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞!

–í Edge Function `sync` –≤–∏–¥–Ω–æ:
- ‚úÖ **526 –∑–∞–ø—Ä–æ—Å–æ–≤** –∑–∞ 15 –º–∏–Ω—É—Ç
- ‚ùå **–ú–Ω–æ–≥–æ 4xx –æ—à–∏–±–æ–∫** (–∂–µ–ª—Ç—ã–µ –ø–æ–ª–æ—Å—ã) ‚Äî —ç—Ç–æ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–µ –æ—à–∏–±–∫–∏
- ‚ö†Ô∏è **Max execution time: 16.7 —Å–µ–∫—É–Ω–¥** ‚Äî –æ–±—ä—è—Å–Ω—è–µ—Ç –∑–∞–¥–µ—Ä–∂–∫—É
- ‚ö†Ô∏è **321 –ª–æ–≥–æ–≤** —Å –æ—à–∏–±–∫–∞–º–∏ –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è–º–∏

**4xx –æ—à–∏–±–∫–∏ –æ–∑–Ω–∞—á–∞—é—Ç:**
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞
- –ü—Ä–æ–±–ª–µ–º—ã —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π
- –û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ initData
- –ü—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ø–æ–¥–ø–∏—Å–∫–∏

---

## üîç –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Edge Function

### 1. –û—Ç–∫—Ä–æ–π—Ç–µ –ª–æ–≥–∏

1. –í Edge Function `sync` –ø–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É **"Logs"**
2. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–ø–∏—Å–∏
3. –ù–∞–π–¥–∏—Ç–µ –∑–∞–ø–∏—Å–∏ —Å **–∫—Ä–∞—Å–Ω—ã–º** –∏–ª–∏ **–∂–µ–ª—Ç—ã–º** —Ü–≤–µ—Ç–æ–º (–æ—à–∏–±–∫–∏ –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è)

**–ß—Ç–æ –∏—Å–∫–∞—Ç—å:**

**A. "Missing x-telegram-init-data header"**
- InitData –Ω–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è
- –†–µ—à–µ–Ω–∏–µ: –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è

**B. "Invalid initData"**
- –ü—Ä–æ–±–ª–µ–º–∞ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π initData
- –†–µ—à–µ–Ω–∏–µ: –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã `BOT_TOKEN`

**C. "User is not subscribed to the channel"**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø–æ–¥–ø–∏—Å–∞–Ω
- –†–µ—à–µ–Ω–∏–µ: –ø–æ–¥–ø–∏—à–∏—Ç–µ—Å—å –Ω–∞ –∫–∞–Ω–∞–ª `@mansurmlrd`

**D. "Hash mismatch"**
- –ü—Ä–æ–±–ª–µ–º–∞ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ø–æ–¥–ø–∏—Å–∏ initData
- –†–µ—à–µ–Ω–∏–µ: –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã –∏ –∫–æ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∏

---

## üîç –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –æ—à–∏–±–∫–∏

### 1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏ –∏–∑ –ª–æ–≥–æ–≤

–ù–∞–π–¥–∏—Ç–µ –≤ –ª–æ–≥–∞—Ö —Å—Ç—Ä–æ–∫–∏ —Å –æ—à–∏–±–∫–∞–º–∏ –∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ:
- –¢–µ–∫—Å—Ç –æ—à–∏–±–∫–∏
- –í—Ä–µ–º—è –æ—à–∏–±–∫–∏
- HTTP —Å—Ç–∞—Ç—É—Å –∫–æ–¥ (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 4xx)

**–ü—Ä–∏–º–µ—Ä—ã –æ—à–∏–±–æ–∫:**
```
[ERROR] Invalid initData
[ERROR] User is not subscribed to the channel
[WARN] Hash mismatch
```

---

## üîç –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞

### 1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Telegram

1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. F12 ‚Üí Console
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—à–∏–±–∫–∏

**–ß—Ç–æ –∏—Å–∫–∞—Ç—å:**

**A. "NOT_SUBSCRIBED"**
- –ù–µ –ø–æ–¥–ø–∏—Å–∞–Ω—ã –Ω–∞ –∫–∞–Ω–∞–ª
- –†–µ—à–µ–Ω–∏–µ: –ø–æ–¥–ø–∏—à–∏—Ç–µ—Å—å –Ω–∞ `@mansurmlrd`

**B. "Invalid initData"**
- –ü—Ä–æ–±–ª–µ–º–∞ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π initData
- –†–µ—à–µ–Ω–∏–µ: –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã

**C. "Failed to load from server"**
- Edge Function –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –†–µ—à–µ–Ω–∏–µ: –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Edge Function

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ 1: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ –∫–∞–Ω–∞–ª

### 1. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–∞–Ω–∞–ª

1. –û—Ç–∫—Ä–æ–π—Ç–µ: https://t.me/mansurmlrd
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã **–ø–æ–¥–ø–∏—Å–∞–Ω—ã**
3. –û–±–Ω–æ–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Telegram

**–ï—Å–ª–∏ –Ω–µ –ø–æ–¥–ø–∏—Å–∞–Ω—ã:**
- –ü–æ–¥–ø–∏—à–∏—Ç–µ—Å—å
- –û–±–Ω–æ–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ 2: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ Edge Function

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã

1. Settings ‚Üí Edge Functions ‚Üí Secrets
2. –î–æ–ª–∂–Ω—ã –±—ã—Ç—å:
   - `BOT_TOKEN` = `7568002456:AAFpZOYNjGXbYxaeZ-fdQwliyCApbpZ7B3A`
   - `TELEGRAM_CHANNEL_ID` = `-1001781839176`

**–ï—Å–ª–∏ —Å–µ–∫—Ä–µ—Ç—ã –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç:**
- –û–±–Ω–æ–≤–∏—Ç–µ –∏—Ö
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Edge Function

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∏ initData

–í–æ–∑–º–æ–∂–Ω–æ, –ø—Ä–æ–±–ª–µ–º–∞ –≤ –ø—Ä–æ–≤–µ—Ä–∫–µ initData. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Edge Function –∫–æ–¥.

---

## üß™ –¢–µ—Å—Ç –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞

–û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Telegram, F12 ‚Üí Console –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```javascript
// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å initData
const initData = window.Telegram?.WebApp?.initData;
console.log('InitData:', initData ? '–ï—Å—Ç—å ‚úÖ' : '–ù–µ—Ç ‚ùå');

// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É
if (initData) {
  fetch('https://zhchkxukgltknfbropqu.supabase.co/functions/v1/sync', {
    method: 'GET',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': 'Bearer sb_publishable_m96BQEXNJw5_L_CI0kQkUg_0vdPodFS',
      'x-telegram-init-data': initData
    }
  })
  .then(r => {
    console.log('Status:', r.status);
    return r.json();
  })
  .then(data => {
    console.log('Response:', data);
    if (data.error) {
      console.error('‚ùå –û—à–∏–±–∫–∞:', data.error);
      if (data.code === 'NOT_SUBSCRIBED') {
        console.error('‚ö†Ô∏è –ù–µ –ø–æ–¥–ø–∏—Å–∞–Ω—ã –Ω–∞ –∫–∞–Ω–∞–ª!');
      }
    } else {
      console.log('‚úÖ –£—Å–ø–µ—à–Ω–æ!');
    }
  })
  .catch(err => console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞:', err));
}
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å—Å—è JSON —Å –¥–∞–Ω–Ω—ã–º–∏ –∏–ª–∏ –æ—à–∏–±–∫–æ–π
- –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ ‚Äî –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏

---

## üìù –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:

1. ‚úÖ **–û—Ç–∫—Ä–æ–π—Ç–µ –ª–æ–≥–∏ Edge Function** ‚Üí –≤–∫–ª–∞–¥–∫–∞ "Logs"
2. ‚úÖ **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–µ–∫—Å—Ç –æ—à–∏–±–æ–∫** (–∫—Ä–∞—Å–Ω—ã–µ/–∂–µ–ª—Ç—ã–µ –∑–∞–ø–∏—Å–∏)
3. ‚úÖ **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞** (F12) –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
4. ‚úÖ **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É** –Ω–∞ –∫–∞–Ω–∞–ª `@mansurmlrd`
5. ‚úÖ **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã** –≤ Edge Function

---

## üÜò –ü—Ä–∏—à–ª–∏—Ç–µ:

1. **–¢–µ–∫—Å—Ç –æ—à–∏–±–æ–∫ –∏–∑ –ª–æ–≥–æ–≤ Edge Function** (–≤–∫–ª–∞–¥–∫–∞ "Logs")
2. **–ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞** (F12 ‚Üí Console)
3. **–ü–æ–¥–ø–∏—Å–∞–Ω—ã –ª–∏ –≤—ã –Ω–∞ –∫–∞–Ω–∞–ª** `@mansurmlrd`

–≠—Ç–æ –ø–æ–º–æ–∂–µ—Ç —Ç–æ—á–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É!
