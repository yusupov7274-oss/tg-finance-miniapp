# üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è 401 –æ—à–∏–±–æ–∫

## ‚úÖ Edge Function –æ–±–Ω–æ–≤–ª–µ–Ω–∞

–¢–µ–ø–µ—Ä—å –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è.

---

## üìã –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ Edge Function –æ–±–Ω–æ–≤–ª–µ–Ω–∞

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–¥ Edge Function

1. Supabase ‚Üí Edge Functions ‚Üí `sync` ‚Üí **Code**
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∫–æ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `apikey` header)
3. –ï—Å–ª–∏ –Ω–µ –æ–±–Ω–æ–≤–ª–µ–Ω ‚Äî –æ–±–Ω–æ–≤–∏—Ç–µ –∏ –∑–∞–¥–µ–ø–ª–æ–π—Ç–µ

---

## üìã –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Invocations –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

### 1. –û—Ç–∫—Ä–æ–π—Ç–µ Invocations

1. Edge Functions ‚Üí `sync` ‚Üí **Invocations**
2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã:
   - –î–æ–ª–∂–Ω—ã –±—ã—Ç—å **200 OK** (–∑–µ–ª–µ–Ω—ã–µ) –≤–º–µ—Å—Ç–æ 401
   - –ï—Å–ª–∏ –≤—Å–µ –µ—â–µ 401 ‚Äî Edge Function –Ω–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∞

---

## üìã –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Edge Function

### 1. –û—Ç–∫—Ä–æ–π—Ç–µ –ª–æ–≥–∏

1. Edge Functions ‚Üí `sync` ‚Üí **Logs**
2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ ‚Äî –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –∑–∞–ø–∏—Å–∏:
   - –£—Å–ø–µ—à–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
   - –ò–ª–∏ –æ—à–∏–±–∫–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)

---

## üìã –®–∞–≥ 4: –¢–µ—Å—Ç –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞

### 1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Telegram

1. F12 ‚Üí Console
2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Ç–µ—Å—Ç:

```javascript
// –ü–æ–ª—É—á–∏—Ç—å initData
const initData = window.Telegram?.WebApp?.initData;
console.log('InitData:', initData ? '–ï—Å—Ç—å ‚úÖ' : '–ù–µ—Ç ‚ùå');

if (!initData) {
  console.error('‚ùå InitData –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω!');
} else {
  // –¢–µ—Å—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
  const testData = {
    accounts: [{ id: 1, name: '–¢–µ—Å—Ç–æ–≤—ã–π —Å—á–µ—Ç', currency: 'RUB', balance: 1000, color: '#2481cc' }],
    transactions: []
  };

  console.log('–û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö...');
  
  fetch('https://zhchkxukgltknfbropqu.supabase.co/functions/v1/sync', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': 'Bearer sb_publishable_m96BQEXNJw5_L_CI0kQkUg_0vdPodFS',
      'x-telegram-init-data': initData
    },
    body: JSON.stringify(testData)
  })
  .then(r => {
    console.log('Status:', r.status);
    if (r.status === 200) {
      console.log('‚úÖ –£—Å–ø–µ—à–Ω–æ!');
    } else if (r.status === 401) {
      console.error('‚ùå –í—Å–µ –µ—â–µ 401 - Edge Function –Ω–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∞');
    } else {
      console.error('‚ùå –û—à–∏–±–∫–∞:', r.status);
    }
    return r.json();
  })
  .then(data => {
    console.log('Response:', data);
    if (data.success) {
      console.log('‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
    } else if (data.error) {
      console.error('‚ùå –û—à–∏–±–∫–∞:', data.error);
    }
  })
  .catch(err => console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞:', err));
}
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- Status: **200** (–Ω–µ 401!)
- Response: `{ success: true }`

---

## üìã –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∞–±–ª–∏—Ü—ã –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–∞

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∞–±–ª–∏—Ü—É `users`

1. Supabase ‚Üí Table Editor ‚Üí **users**
2. –î–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è –∑–∞–ø–∏—Å—å —Å –≤–∞—à–∏–º `telegram_user_id`
3. `is_subscriber` –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å `true`

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∞–±–ª–∏—Ü—É `user_data`

1. Table Editor ‚Üí **user_data**
2. –î–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –∑–∞–ø–∏—Å–∏:
   - `key` = `accounts`
   - `key` = `transactions`
   - –ò —Ç.–¥.

---

## ‚ùì –ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –í—Å–µ –µ—â–µ 401 –æ—à–∏–±–∫–∏

**–ü—Ä–∏—á–∏–Ω–∞:** Edge Function –Ω–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∞

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–¥ Edge Function
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥–æ–±–∞–≤–∏–ª–∏ `apikey` header
3. –ó–∞–¥–µ–ø–ª–æ–π—Ç–µ –∑–∞–Ω–æ–≤–æ

### –ü—Ä–æ–±–ª–µ–º–∞ 2: 200 OK, –Ω–æ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç

**–ü—Ä–∏—á–∏–Ω–∞:** –û—à–∏–±–∫–∞ –≤ –∫–æ–¥–µ Edge Function

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Edge Function
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–µ–∫—Ä–µ—Ç—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞

### –ü—Ä–æ–±–ª–µ–º–∞ 3: "NOT_SUBSCRIBED"

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ –ø–æ–¥–ø–∏—Å–∞–Ω—ã –Ω–∞ –∫–∞–Ω–∞–ª

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü–æ–¥–ø–∏—à–∏—Ç–µ—Å—å –Ω–∞ `@mansurmlrd`
2. –û–±–Ω–æ–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

---

## üìù –ß–µ–∫-–ª–∏—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏:

- [ ] Edge Function –æ–±–Ω–æ–≤–ª–µ–Ω–∞ (–¥–æ–±–∞–≤–ª–µ–Ω `apikey` header)
- [ ] Edge Function –∑–∞–¥–µ–ø–ª–æ–µ–Ω–∞
- [ ] Invocations –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç 200 OK (–Ω–µ 401)
- [ ] –¢–µ—Å—Ç –≤ –∫–æ–Ω—Å–æ–ª–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 200
- [ ] –î–∞–Ω–Ω—ã–µ –ø–æ—è–≤–ª—è—é—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü–∞—Ö

---

## üÜò –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ–π—á–∞—Å:

1. ‚úÖ **–û–±–Ω–æ–≤–ª–µ–Ω–∞ –ª–∏ Edge Function?** (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–¥)
2. ‚úÖ **–ö–∞–∫–∏–µ —Å—Ç–∞—Ç—É—Å—ã –≤ Invocations?** (200 –∏–ª–∏ –≤—Å–µ –µ—â–µ 401?)
3. ‚úÖ **–ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–µ—Å—Ç –≤ –∫–æ–Ω—Å–æ–ª–∏?** (Status: 200?)

–°–æ–æ–±—â–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏!
