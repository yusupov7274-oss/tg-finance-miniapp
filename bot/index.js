import "dotenv/config";
import TelegramBot from "node-telegram-bot-api";

const bot = new TelegramBot(process.env.BOT_TOKEN, { polling: true });
const webAppUrl = process.env.WEBAPP_URL;

// ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ… Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ
if (!process.env.BOT_TOKEN) {
  console.error("âŒ BOT_TOKEN Ð½Ðµ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½ Ð² .env Ñ„Ð°Ð¹Ð»Ðµ!");
  process.exit(1);
}

if (!webAppUrl) {
  console.error("âŒ WEBAPP_URL Ð½Ðµ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½ Ð² .env Ñ„Ð°Ð¹Ð»Ðµ!");
  process.exit(1);
}

console.log("âœ… Ð‘Ð¾Ñ‚ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½");
console.log(`ðŸ“± Web App URL: ${webAppUrl}`);

bot.onText(/\/start/, (msg) => {
  const chatId = msg.chat.id;

  // Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ inline keyboard Ð´Ð»Ñ Ð±Ð¾Ð»ÐµÐµ Ð½Ð°Ð´ÐµÐ¶Ð½Ð¾Ð¹ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹
  bot.sendMessage(chatId, "ðŸ’° Ð›Ð¸Ñ‡Ð½Ñ‹Ðµ Ñ„Ð¸Ð½Ð°Ð½ÑÑ‹\n\nÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð´Ð»Ñ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ Ð²Ð°ÑˆÐ¸Ð¼Ð¸ Ñ„Ð¸Ð½Ð°Ð½ÑÐ°Ð¼Ð¸ ðŸ‘‡", {
    reply_markup: {
      inline_keyboard: [
        [
          {
            text: "ðŸ“Š ÐžÑ‚ÐºÑ€Ñ‹Ñ‚ÑŒ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ",
            web_app: { url: webAppUrl },
          },
        ],
      ],
    },
  });
});

// ÐšÐ¾Ð¼Ð°Ð½Ð´Ð° /help
bot.onText(/\/help/, (msg) => {
  const chatId = msg.chat.id;
  bot.sendMessage(chatId, "ðŸ“– Ð”Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹:\n\n/start - ÐžÑ‚ÐºÑ€Ñ‹Ñ‚ÑŒ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ\n/help - ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ ÑÐ¿Ñ€Ð°Ð²ÐºÑƒ");
});

bot.on("polling_error", (err) => {
  console.error("polling_error:", err?.message || err);
});

console.log("Bot is running...");
